{% extends 'base.html' %}

{% block title %}Forest Monitoring Dashboard{% endblock %}

{% block content %}
<header class="header">
    <div class="container">
        <div class="header-content">
            <div class="logo">Forest Watch</div>
            <nav class="navbar">
                <a href="#overview" class="nav-link">Overview</a>
                <a href="#map" class="nav-link">Map</a>
                <a href="#analytics" class="nav-link">Analytics</a>
                <a href="#alerts" class="nav-link">Alerts</a>
                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="nav-link">Logout</a>
                {% else %}
                <a href="{% url 'login' %}" class="nav-link">Login</a>
                {% endif %}
            </nav>
        </div>
    </div>
</header>

<section class="hero">
    <div class="container">
        <div class="hero-content">
            <h1>Forest Monitoring Dashboard</h1>
            <p>Real-time tracking and analysis of forest health, biodiversity, and environmental metrics</p>
            <button class="cta-button">Start Monitoring</button>
        </div>
    </div>
</section>

<section id="overview" class="dashboard-overview">
    <div class="container">
        <h2 class="section-title">Real-Time Metrics</h2>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon">9,847</div>
                <h3>Forest Coverage</h3>
                <div class="metric-value">9,847</div>
                <div class="metric-subtitle">hectares monitored</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">92%</div>
                <h3>Vegetation Health</h3>
                <div class="metric-value">92%</div>
                <div class="metric-subtitle">healthy coverage</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">1,234</div>
                <h3>Species Count</h3>
                <div class="metric-value">1,234</div>
                <div class="metric-subtitle">unique species identified</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">3.2C</div>
                <h3>Avg Temperature</h3>
                <div class="metric-value">3.2</div>
                <div class="metric-subtitle">degrees change</div>
            </div>
        </div>
    </div>
</section>

<section id="map" class="map-section">
    <div class="container">
        <h2 class="section-title">Interactive Map View</h2>

        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

        <!-- Map Container -->
        <div id="forest-map"
            style="height: 500px; width: 100%; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>

        <!-- Leaflet JS -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize Map
                var map = L.map('forest-map').setView([0, 0], 2); // Default view

                // Add Dark/Satellite Style Tile Layer
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }).addTo(map);

                // Fetch Data
                fetch('/satellite/api/map-data/')
                    .then(response => response.json())
                    .then(data => {
                        if (data.features.length > 0) {
                            // 1. Add Tile Layers (Base Forest Cover)
                            data.features.forEach(f => {
                                if (f.properties.type === 'AOI' && f.properties.tile_url) {
                                    L.tileLayer(f.properties.tile_url, {
                                        opacity: 0.7,
                                        attribution: 'Google Earth Engine / Dynamic World'
                                    }).addTo(map);
                                }
                            });

                            // 2. Add Vector Overlays
                            var geoJsonLayer = L.geoJSON(data, {
                                pointToLayer: function (feature, latlng) {
                                    if (feature.properties.type === 'AOI') {
                                        return L.circle(latlng, {
                                            color: '#10b981',
                                            fillOpacity: 0.1,
                                            radius: (feature.properties.radius_km * 1000)
                                        });
                                    } else if (feature.properties.type === 'Alert') {
                                        return L.circleMarker(latlng, {
                                            radius: 10,
                                            fillColor: "#ef4444",
                                            color: "#ffffff",
                                            weight: 2,
                                            fillOpacity: 0.9
                                        });
                                    }
                                },
                                onEachFeature: function (feature, layer) {
                                    if (feature.properties.popup) {
                                        layer.bindPopup(feature.properties.popup);
                                    }
                                }
                            }).addTo(map);

                            map.fitBounds(geoJsonLayer.getBounds());
                        }
                    })
                    .catch(error => console.error('Error loading map data:', error));
            });
        </script>

        <div class="risk-meter" style="margin-top: 1rem;">
            <p class="analytics-label">Map displays monitored Areas of Interest (Green) and Deforestation Alerts (Red).
            </p>
        </div>
    </div>
</section>

<section id="alerts" class="alerts-section">
    <div class="container">
        <h2 class="section-title">Active Alerts</h2>
        <div class="alerts-list">
            <div class="alert-item alert-low">
                <div class="alert-header">
                    <h4>Seasonal Growth Detected</h4>
                    <span class="alert-badge alert-badge-low">Low</span>
                </div>
                <p class="alert-time">2 hours ago</p>
                <p class="alert-description">Vegetation growth increased by 12% in the northern sector. This is expected
                    seasonal growth pattern.</p>
            </div>
            <div class="alert-item alert-medium">
                <div class="alert-header">
                    <h4>Water Stress Moderate</h4>
                    <span class="alert-badge alert-badge-medium">Medium</span>
                </div>
                <p class="alert-time">4 hours ago</p>
                <p class="alert-description">Soil moisture levels in central zone have decreased to 62%. Monitor for
                    potential intervention.</p>
            </div>
            <div class="alert-item alert-low">
                <div class="alert-header">
                    <h4>Wildlife Activity Normal</h4>
                    <span class="alert-badge alert-badge-low">Low</span>
                </div>
                <p class="alert-time">8 hours ago</p>
                <p class="alert-description">Camera traps recorded 47 species movements today, all within expected
                    parameters for this season.</p>
            </div>
        </div>
    </div>
</section>

<section class="about-section">
    <div class="container">
        <h2 class="section-title">Our Mission</h2>
        <div class="about-content">
            <div class="about-card">
                <h3>Real-Time Monitoring</h3>
                <p>Continuous satellite and sensor data collection providing live insights into forest health and
                    environmental changes.</p>
            </div>
            <div class="about-card">
                <h3>Data-Driven Decision Making</h3>
                <p>Advanced analytics and predictive models help managers make informed decisions about forest
                    conservation and management.</p>
            </div>
            <div class="about-card">
                <h3>Biodiversity Protection</h3>
                <p>Comprehensive species tracking and habitat monitoring ensure ecosystem resilience and long-term
                    conservation success.</p>
            </div>
        </div>
    </div>
</section>

<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <p>Forest Watch Dashboard</p>
            <p class="footer-message">Protecting forests, preserving biodiversity, securing our future</p>
            <p>&copy; 2026 Forest Watch. All rights reserved.</p>
        </div>
    </div>
</footer>
{% endblock %}